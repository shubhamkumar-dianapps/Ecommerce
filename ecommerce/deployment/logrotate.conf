# Logrotate configuration for Django E-commerce Application
#
# This file should be placed in /etc/logrotate.d/ on Linux systems
# For local development, this serves as documentation
#
# Installation:
#   sudo cp deployment/logrotate.conf /etc/logrotate.d/ecommerce
#   sudo chmod 644 /etc/logrotate.d/ecommerce
#
# Test configuration:
#   sudo logrotate -d /etc/logrotate.d/ecommerce
#
# Force rotation (for testing):
#   sudo logrotate -f /etc/logrotate.d/ecommerce

/path/to/ecommerce/logs/*.log {
    # Rotate daily
    daily
    
    # Keep 30 days of logs
    rotate 30
    
    # Compress old logs
    compress
    
    # Delay compression until next rotation (keeps most recent backup uncompressed)
    delaycompress
    
    # Don't rotate if log is empty
    notifempty
    
    # Don't error if log file is missing
    missingok
    
    # Create new log file with these permissions after rotation
    create 0644 www-data www-data
    
    # Use date as suffix for rotated files (e.g., general.log-20260211)
    dateext
    dateformat -%Y%m%d
    
    # Run this script after rotation
    postrotate
        # Reload application to reopen log files (if using systemd)
        # systemctl reload ecommerce.service
        
        # Or send HUP signal to gunicorn/uwsgi
        # pkill -HUP gunicorn
    endscript
    
    # Special handling for critical logs
    /path/to/ecommerce/logs/payment.log {
        # Keep payment logs for 1 year
        rotate 365
        
        # Never delete payment logs automatically
        maxage 365
    }
    
    /path/to/ecommerce/logs/security.log {
        # Keep security logs for 90 days
        rotate 90
    }
}
